const getCookieLoginPopup=name=>{const parts=`; ${document.cookie}`.split(`; ${name}=`);if(parts.length===2)return parts.pop().split(";").shift()},getSellerDomain=()=>{let seller_domain=document.getElementById("sellerDomain")?.value;try{seller_domain||(seller_domain=window.location.hostname)}catch(err){console.error(err)}return seller_domain};function setCookieLoginPopup(name,value,minutesToExpire){if(minutesToExpire){var date=new Date;date.setTime(date.getTime()+minutesToExpire*60*1e3);var expires="expires="+date.toUTCString();document.cookie=name+"="+value+";"+expires+";path=/"}else{var date=new Date;date.setFullYear(date.getFullYear()+10);var expires=date.toUTCString();document.cookie=name+"="+value+";expires="+expires+";path=/"}}var HttpCallPopup=function(url,method,data,success,failure){let xhr=new XMLHttpRequest;xhr.open(method,url,!0),xhr.setRequestHeader("Content-Type","application/json;charset=UTF-8"),url==="https://uptime2.fastrr.com/fe2"&&(xhr.timeout=2e3),data?xhr.send(data):xhr.send();const DONE=typeof XMLHttpRequest.DONE<"u"?XMLHttpRequest.DONE:4;xhr.onreadystatechange=function(){if(xhr.readyState===DONE){let status=xhr.status,response;try{response=JSON.parse(xhr.responseText)}catch{response=xhr.responseText}if(status===0||status>=100&&status<300){if(typeof success=="function")return success(response)}else if(typeof failure=="function")return failure(response)}}},isFastrrUp=1,ipAddress=null;const ShiprocketLoginPopupClosed=!!getCookieLoginPopup("shiprocketLoginPopupClosed"),uuid_cookie=getCookieLoginPopup("fastrr_uuid")?getCookieLoginPopup("fastrr_uuid"):null,usid_cookie=getCookieLoginPopup("fastrr_usid")?getCookieLoginPopup("fastrr_usid"):null,sellerConfigFL=getCookieLoginPopup("fastrr_seller_config")?getCookieLoginPopup("fastrr_seller_config"):null;let pageVisitTime;const updatePayload=async(currentPayload,pageExit)=>{const user_id=getCookieLoginPopup("fastrr_user_id")?getCookieLoginPopup("fastrr_user_id"):null,user_profile_id=getCookieLoginPopup("fastrr_user_profile_id")?getCookieLoginPopup("fastrr_user_profile_id"):null;switch(window.ShopifyAnalytics?.meta?.page?.pageType?.toUpperCase()){case"PRODUCT":return{...currentPayload,data:{productID:window.ShopifyAnalytics?.meta?.product?.id??"",productType:window.ShopifyAnalytics?.meta?.product?.type??"",selectedVariantId:window.ShopifyAnalytics?.meta?.selectedVariantId??"",...pageExit?{durationMs:Date.now()-pageVisitTime}:{},...user_id?{user_id}:{},...user_profile_id?{user_profile_id}:{}}};case"COLLECTION":return{...currentPayload,data:{resourceID:window.ShopifyAnalytics?.meta?.page?.resourceId??"",resourceType:window.ShopifyAnalytics?.meta?.page?.resourceType??"",...pageExit?{durationMs:Date.now()-pageVisitTime}:{},...user_id?{user_id}:{},...user_profile_id?{user_profile_id}:{}}};case"CART":const data=await(await fetch(`${window.location.origin}${window.location.pathname}.js`)).json();return{...currentPayload,data:{itemCount:data?.item_count,totalPrice:data?.total_price,totalDiscount:data?.total_discount,...pageExit?{durationMs:Date.now()-pageVisitTime}:{},...user_id?{user_id}:{},...user_profile_id?{user_profile_id}:{}},cdata:data?.items?.length?data?.items?.map(itemDetails=>({itemName:itemDetails?.title,quantity:itemDetails?.quantity,price:itemDetails?.price,discountedPrice:itemDetails?.discounted_price})):[]};default:return{...currentPayload,...pageExit||user_id?{data:{...pageExit?{durationMs:Date.now()-pageVisitTime}:{},...user_id?{user_id}:{},...user_profile_id?{user_profile_id}:{}}}:{}}}},sendFastrrEvents=async(uuid_cookie2,usid_cookie2,pageExit,eventName)=>{const timestamp=new Date().toISOString();let eventPayload={uuid:uuid_cookie2,usid:usid_cookie2,et:timestamp,etype:eventName,ptype:window.ShopifyAnalytics?.meta?.page?.pageType,pstype:"",ppath:window.location.pathname};eventPayload=await updatePayload(eventPayload,pageExit),HttpCallPopup("https://events.pickrr.com/collect","POST",JSON.stringify(eventPayload)),setCookieLoginPopup("fastrr_uuid",uuid_cookie2),setCookieLoginPopup("fastrr_usid",usid_cookie2,30)};function generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})}function generateSessionID(new_uuid){const timestamp=Date.now();return`${new_uuid}-${timestamp}`}const triggerFastrLogin=async accountIconClicked=>{pageVisitTime=Date.now();var isFastrrUp2=1,ipAddress2=null;const ShiprocketLoginPopupClosed2=!!getCookieLoginPopup("shiprocketLoginPopupClosed"),ShiprocketLoginCompleted=!!getCookieLoginPopup("ShiprocketLoginCompleted"),uuid_cookie2=getCookieLoginPopup("fastrr_uuid")?getCookieLoginPopup("fastrr_uuid"):null,usid_cookie2=getCookieLoginPopup("fastrr_usid")?getCookieLoginPopup("fastrr_usid"):null,shopifyLoginError=getCookieLoginPopup("shopifyLoginError")?getCookieLoginPopup("shopifyLoginError"):null,sellerConfigFL2=getCookieLoginPopup("fastrr_seller_config")?getCookieLoginPopup("fastrr_seller_config"):null,SessionShiprocketLoginCompleted=!!getCookieLoginPopup("SessionShiprocketLoginCompleted");let uId=encodeURI(btoa(getSellerDomain())),loginPopupEnabled=!1,eventsEnabled=!1,sellerConfigParent=null;if(!sellerConfigFL2)await fetch("https://events.pickrr.com/config",{method:"GET",headers:{uId}}).then(response=>{if(!response.ok)throw new Error("Network response was not ok");return response.json()}).then(data=>{loginPopupEnabled=data?.data?.popupConfigList?.[0]?.enabled??!1,eventsEnabled=data?.data?.eventsEnabled??!1,setCookieLoginPopup("fastrr_seller_config",JSON.stringify(data),30),sellerConfigParent=JSON.stringify(data)}).catch(error=>{});else{const sellerConfig=JSON.parse(sellerConfigFL2);sellerConfigParent=sellerConfigFL2,loginPopupEnabled=sellerConfig?.data?.popupConfigList?.[0]?.enabled??!1,eventsEnabled=sellerConfig?.data?.eventsEnabled??!1}if(eventsEnabled){if(!uuid_cookie2){const new_uuid=generateUUID(),new_usid=generateSessionID(new_uuid);sendFastrrEvents(new_uuid,new_usid,!1,"USER_EVENT_PAGE_TYPE")}if(uuid_cookie2&&!usid_cookie2){const new_usid=generateSessionID(uuid_cookie2);sendFastrrEvents(uuid_cookie2,new_usid,!1,"USER_EVENT_PAGE_TYPE")}uuid_cookie2&&usid_cookie2&&sendFastrrEvents(uuid_cookie2,usid_cookie2,!1,"USER_EVENT_PAGE_TYPE")}if(!document.getElementById("headless-container")&&(!ShiprocketLoginPopupClosed2&&!ShiprocketLoginCompleted&&!window.location?.pathname?.includes("/account")&&loginPopupEnabled||(window.location?.pathname?.includes("/account")||accountIconClicked)&&!shopifyLoginError)&&!window.ShopifyAnalytics?.meta?.page?.customerId){const pageType=window.location?.pathname?.includes("/account")||accountIconClicked?"account":"Landing";let headlessApplication=document.createElement("div");const url=`https://fastrr-boost-ui.pickrr.com/?popupType=shiprocketLogin&pageType=${pageType}&seller-domain=${getSellerDomain()}&ipAddress=${ipAddress2}${SessionShiprocketLoginCompleted?"&SessionShiprocketLoginCompleted=true":""}${sellerConfigParent?`&sellerConfigParent=${window.btoa(encodeURIComponent(sellerConfigParent))}`:""}`;headlessApplication.id="headless-container",headlessApplication.innerHTML=`<div class="headless-modal">
              <div class="headless-modal-content">
              <div class="headless-modal-body">
                  <iframe id="headless-iframe-login" src="${url}" allow="clipboard-read; clipboard-write"></iframe>
              </div>
              </div>
          </div>`;const bodyStyle=document.body.style;bodyStyle.overflow="hidden",document.body.appendChild(headlessApplication)}let LoginActions={};const CloseLoginPopup=function(){setCookieLoginPopup("shiprocketLoginPopupClosed","1",1440);const scrollY=document.body.style.top;document.getElementById("headless-container").remove(),document.querySelector("body").style.overflow="auto",window.scrollTo(0,parseInt(scrollY||"0")*-1)},loginCompleted=function(){setCookieLoginPopup("ShiprocketLoginCompleted","1"),setCookieLoginPopup("SessionShiprocketLoginCompleted","1",1440)},saveCouponCode=function(couponCode){localStorage.setItem("fastrrCouponCode",couponCode)},handelShopifyLoginError=function(data){setCookieLoginPopup("shopifyLoginError","1",30);const scrollY=document.body.style.top;document.getElementById("headless-container").remove(),document.querySelector("body").style.overflow="auto",window.scrollTo(0,parseInt(scrollY||"0")*-1),window.location.href="/account/register"},handelShopifyLogin=()=>{setCookieLoginPopup("SessionShiprocketLoginCompleted","1",1)},openTrueCaller=(data,payload)=>{window.open(data,"_top"),setTimeout(()=>{document.hasFocus()||document.getElementById("headless-iframe-login")?.contentWindow?.postMessage({trigger:"true-caller-request",payload},"*")},600)},ac=new AbortController,FetchAndAutofillOtpLoginPopup=e=>{navigator.credentials.get({otp:{transport:["sms"]},signal:ac.signal}).then(otp=>{document.getElementById("headless-iframe-login").contentWindow.postMessage({trigger:"otp-autofill",data:otp.code},"*")}).catch(err=>{})},startListeningMessageLoginPopup=()=>{"OTPCredential"in window&&window.addEventListener("load",FetchAndAutofillOtpLoginPopup())},stopListeningMessageLoginPopup=()=>{ac.abort(),window.removeEventListener("load",FetchAndAutofillOtpLoginPopup())};LoginActions.loadStorage=function(data){document.getElementById("headless-iframe-login").contentWindow.postMessage({trigger:"headless-storage",data:JSON.stringify(window.localStorage)},"*")};let LoginPopupActionHandler=function(actions){if(actions&&actions.length>0)for(let action of actions)typeof LoginActions[action.action]=="function"&&LoginActions[action.action](action.data)},ShiprocketLoginMessageListener=function(event){const urlSearchParams=new URLSearchParams(window.location.search);let data=event.data;switch(data.trigger){case"headless-storage":LoginPopupActionHandler(data.actions);break;case"Login-popup-close":CloseLoginPopup();break;case"save-coupon-code":saveCouponCode(data?.couponCode);break;case"login-completed":loginCompleted();break;case"Shopify-login-error":handelShopifyLoginError(data);break;case"open-true-caller-login":openTrueCaller(data?.data,data?.payload);break;case"otp-read-start":startListeningMessageLoginPopup();break;case"otp-read-stop":stopListeningMessageLoginPopup();break;case"shopify-logged-in":handelShopifyLogin();default:break}};window.addEventListener("message",ShiprocketLoginMessageListener,!1)};window.shipRocketMarketingLogin=()=>{triggerFastrLogin(!0)},addEventListener("load",async event=>{triggerFastrLogin(!1)}),addEventListener("beforeunload",async event=>{var isFastrrUp2=1;const uuid_cookie2=getCookieLoginPopup("fastrr_uuid")?getCookieLoginPopup("fastrr_uuid"):null,usid_cookie2=getCookieLoginPopup("fastrr_usid")?getCookieLoginPopup("fastrr_usid"):null,sellerConfigFL2=getCookieLoginPopup("fastrr_seller_config")?getCookieLoginPopup("fastrr_seller_config"):null;let uId=encodeURI(btoa(getSellerDomain()));var eventsEnabled=!1;if(sellerConfigFL2?eventsEnabled=JSON.parse(sellerConfigFL2)?.data?.eventsEnabled??!1:await fetch("https://events.pickrr.com/config",{method:"GET",headers:{uId}}).then(response=>{if(!response.ok)throw new Error("Network response was not ok");return response.json()}).then(data=>{eventsEnabled=data?.data?.eventsEnabled,setCookieLoginPopup("fastrr_seller_config",JSON.stringify(data),30)}).catch(error=>{}),eventsEnabled){if(!uuid_cookie2){const new_uuid=generateUUID(),new_usid=generateSessionID(new_uuid);sendFastrrEvents(new_uuid,new_usid,!0,"USER_EVENT_PAGE_EXIT")}if(uuid_cookie2&&!usid_cookie2){const new_usid=generateSessionID(uuid_cookie2);sendFastrrEvents(uuid_cookie2,new_usid,!0,"USER_EVENT_PAGE_EXIT")}uuid_cookie2&&usid_cookie2&&sendFastrrEvents(uuid_cookie2,usid_cookie2,!0,"USER_EVENT_PAGE_EXIT")}});
//# sourceMappingURL=/cdn/shop/t/196/assets/shiprocketMarketing.js.map?v=158451428815057201501770880882
